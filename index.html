<script>
/* ---------------- LANGUAGE STATE ---------------- */

let leftLang = "jam";
let rightLang = "eng";
let autoDetected = null;

/* ---------------- BUTTON SETUP ---------------- */

const leftButtons = document.querySelectorAll(".lang.left");
const rightButtons = document.querySelectorAll(".lang.right");

function setActive(buttons, lang) {
  buttons.forEach(b => {
    b.classList.toggle("active", b.dataset.lang === lang);
  });
}

function updateAutoLabel() {
  const autoBtn = document.querySelector('.lang[data-lang="auto"]');
  if (!autoBtn) return;

  if (!document.getElementById("input").value.trim()) {
    autoBtn.textContent = "Auto";
  } else if (autoDetected) {
    autoBtn.textContent =
      (autoDetected === "eng" ? "English" : "Zamœlis") + " · Auto";
  }
}

/* ---------------- CLICK HANDLERS ---------------- */

leftButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    const lang = btn.dataset.lang;

    if (lang === rightLang) {
      rightLang = leftLang;
      setActive(rightButtons, rightLang);
    }

    leftLang = lang;
    setActive(leftButtons, leftLang);
    translateText();
  });
});

rightButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    const lang = btn.dataset.lang;

    if (lang === leftLang) {
      leftLang = rightLang;
      setActive(leftButtons, leftLang);
    }

    rightLang = lang;
    setActive(rightButtons, rightLang);
    translateText();
  });
});

/* ---------------- AUTO DETECTION ---------------- */

function detectLanguageSimple(text) {
  let jam = 0, eng = 0;
  const words = text.toLowerCase().split(/\s+/);

  words.forEach(w => {
    if (jamToEng[w]) jam++;
    if (engToJam[w]) eng++;
  });

  return jam >= eng ? "jam" : "eng";
}

/* ---------------- TRANSLATION ---------------- */

function translateText() {
  const input = document.getElementById("input").value;
  const output = document.getElementById("result");

  if (!input.trim()) {
    output.textContent = "";
    autoDetected = null;
    updateAutoLabel();
    return;
  }

  let from = leftLang;
  let to = rightLang;

  if (leftLang === "auto") {
    autoDetected = detectLanguageSimple(input);
    from = autoDetected;
    updateAutoLabel();
  }

  const tokens = tokenize(input);
  const dict = from === "jam" ? jamToEng : engToJam;

  output.textContent = translateWithPhrases(tokens, dict);
}

/* ---------------- LIVE INPUT ---------------- */

document.getElementById("input").addEventListener("input", translateText);
</script>
