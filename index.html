<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Jamalese Translator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
* { box-sizing: border-box; }

:root {
  --bg: #0b0e1a;
  --card: #151a33;
  --text: #f1f3ff;
  --muted: #aab;
  --accent: #7c8cff;
  --border: #2b2f55;
  --transition: 0.35s ease;
}

[data-theme="light"] {
  --bg: #f4f6fb;
  --card: #ffffff;
  --text: #111;
  --muted: #666;
  --border: #ddd;
}

body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  transition: background var(--transition), color var(--transition);
}

.container {
  max-width: 1100px;
  margin: 50px auto;
  padding: 20px;
}

.card {
  background: var(--card);
  border-radius: 20px;
  padding: 26px;
  transition: background var(--transition);
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

h1 { margin: 0; font-size: 28px; }

/* ---------- FIXED SWITCH ---------- */
.toggle-wrap {
  display: flex;
  align-items: center;
  gap: 10px;
}

.switch {
  width: 50px;
  height: 26px;
  background: #555;
  border-radius: 20px;
  position: relative;
  cursor: pointer;
  transition: background var(--transition);
}

.switch::after {
  content: "";
  position: absolute;
  width: 20px;
  height: 20px;
  background: white;
  border-radius: 50%;
  top: 3px;
  left: 3px;
  transition: transform var(--transition);
}

/* DARK MODE (ON) */
[data-theme="dark"] .switch {
  background: var(--accent);
}

[data-theme="dark"] .switch::after {
  transform: translateX(24px);
}
/* -------------------------------- */

.panes {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  position: relative;
}

@media (max-width: 700px) {
  .panes { grid-template-columns: 1fr; }
}

.swap-btn {
  position: absolute;
  top: 42px;
  left: 50%;
  transform: translateX(-50%);
  background: none;
  border: none;
  font-size: 22px;
  cursor: pointer;
  color: var(--muted);
}

@media (max-width: 700px) {
  .swap-btn {
    top: auto;
    bottom: calc(50% + 10px);
  }
}

.lang-tabs {
  position: relative;
  display: flex;
  gap: 18px;
  margin-bottom: 8px;
}

.lang-tab {
  cursor: pointer;
  color: var(--muted);
  padding-bottom: 6px;
}

.lang-tab.active {
  color: var(--text);
}

.underline {
  position: absolute;
  bottom: 0;
  height: 2px;
  background: var(--accent);
  transition: var(--transition);
}

.pane {
  display: flex;
  flex-direction: column;
  height: 260px;
}

textarea {
  flex: 1;
  resize: none;
  border-radius: 14px;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text);
  padding: 14px;
  font-size: 16px;
}

.output-box {
  flex: 1;
  border-radius: 14px;
  border: 1px solid var(--border);
  padding: 14px;
  position: relative;
}

#result { white-space: pre-wrap; }

.copy-btn {
  position: absolute;
  bottom: 10px;
  left: 10px;
  background: none;
  border: none;
  cursor: pointer;
  color: var(--muted);
  display: none;
}

.copy-btn.visible { display: block; }
.copy-btn.copied { color: var(--accent); cursor: default; }

.footer {
  margin-top: 20px;
  font-size: 13px;
  display: flex;
  justify-content: space-between;
  color: var(--muted);
}

.footer a { color: var(--accent); text-decoration: none; }
</style>
</head>

<body>
<div class="container">
<div class="card">

<header>
<h1>Jamalese Translator</h1>
<div class="toggle-wrap">
‚òÄÔ∏è <div class="switch" id="themeSwitch"></div> üåô
</div>
</header>

<div class="panes">
<button class="swap-btn" id="swapBtn">‚áÑ</button>

<div class="pane">
<div class="lang-tabs" id="sourceTabs">
<div class="lang-tab active" data-lang="auto"><span>Auto</span></div>
<div class="lang-tab" data-lang="jam"><span>Zam≈ìlis</span></div>
<div class="lang-tab" data-lang="eng"><span>English</span></div>
<div class="underline"></div>
</div>
<textarea id="input"></textarea>
</div>

<div class="pane">
<div class="lang-tabs" id="targetTabs">
<div class="lang-tab active" data-lang="eng"><span>English</span></div>
<div class="lang-tab" data-lang="jam"><span>Zam≈ìlis</span></div>
<div class="underline"></div>
</div>

<div class="output-box">
<div id="result"></div>
<button class="copy-btn" id="copyBtn">üìã Copy</button>
</div>
</div>
</div>

<div class="footer">
<span>View the full dictionary at <a href="https://newhs.cc/dict">newhs.cc/dict</a></span>
<span>Created by <a href="https://github.com/nadfd">nadfd</a></span>
</div>

</div>
</div>

<script src="https://newhs.cc/words.js"></script>
<script>
/* ---------- FIXED THEME LOGIC ---------- */
const themeSwitch = document.getElementById("themeSwitch");
const savedTheme = localStorage.getItem("theme") || "dark";

document.documentElement.dataset.theme = savedTheme;

themeSwitch.onclick = () => {
  const next =
    document.documentElement.dataset.theme === "dark"
      ? "light"
      : "dark";
  document.documentElement.dataset.theme = next;
  localStorage.setItem("theme", next);
};
/* ------------------------------------- */

/* ----- translation logic untouched ----- */
const engToJam={}, jamToEng={};
for(const [j,e] of dictionary){
  const parts=e.split(",").map(p=>p.replace(/\(.*?\)/g,"").trim().toLowerCase()).filter(Boolean);
  jamToEng[j]=parts;
  parts.forEach(p=>{
    engToJam[p]??=[];
    if(!engToJam[p].includes(j)) engToJam[p].push(j);
  });
}

let source="auto", target="eng";

function refreshUnderline(c){
  const a=c.querySelector(".lang-tab.active span");
  const u=c.querySelector(".underline");
  if(!a) return;
  u.style.width=a.offsetWidth+"px";
  u.style.left=a.offsetLeft+"px";
}

function activate(id,lang){
  const c=document.getElementById(id);
  c.querySelectorAll(".lang-tab").forEach(t=>{
    t.classList.toggle("active",t.dataset.lang===lang);
  });
  refreshUnderline(c);
}

function setLang(isSource,lang){
  if(isSource){
    source=lang;
    activate("sourceTabs",lang);
    if(source!=="auto" && source===target){
      target=source==="eng"?"jam":"eng";
      activate("targetTabs",target);
    }
  } else {
    target=lang;
    activate("targetTabs",lang);
    if(source!=="auto" && source===target){
      source=target==="eng"?"jam":"eng";
      activate("sourceTabs",source);
    }
  }
  translate();
}

document.querySelectorAll(".lang-tabs").forEach(c=>{
  c.querySelectorAll(".lang-tab").forEach(t=>{
    t.onclick=()=>setLang(c.id==="sourceTabs",t.dataset.lang);
  });
  refreshUnderline(c);
  new ResizeObserver(()=>refreshUnderline(c)).observe(c);
});

document.getElementById("swapBtn").onclick=()=>{
  if(source==="auto") return;
  [source,target]=[target,source];
  activate("sourceTabs",source);
  activate("targetTabs",target);
  translate();
};

const input=document.getElementById("input");
const result=document.getElementById("result");
const copyBtn=document.getElementById("copyBtn");
const autoSpan=document.querySelector('[data-lang="auto"] span');

function detect(w){
  let j=0,e=0;
  w.forEach(x=>{if(jamToEng[x])j++;if(engToJam[x])e++;});
  return j>=e?"jam":"eng";
}

function translate(){
  const txt=input.value.trim();
  if(!txt){
    result.textContent="";
    copyBtn.classList.remove("visible");
    autoSpan.textContent="Auto";
    refreshUnderline(document.getElementById("sourceTabs"));
    return;
  }

  const words=txt.toLowerCase().split(/\s+/);
  const d=detect(words);

  if(source==="auto"){
    autoSpan.textContent=(d==="eng"?"English":"Zam≈ìlis")+" ‚Äì Auto";
    refreshUnderline(document.getElementById("sourceTabs"));
  }

  const dict=(source==="jam"||(source==="auto"&&d==="jam"))?jamToEng:engToJam;
  result.textContent=words.map(w=>dict[w]?.[0]||w).join(" ");
  copyBtn.classList.add("visible");
}

input.addEventListener("input",translate);

copyBtn.onclick=()=>{
  navigator.clipboard.writeText(result.textContent);
  copyBtn.textContent="‚úî Copied";
  copyBtn.classList.add("copied");
  setTimeout(()=>{
    copyBtn.textContent="üìã Copy";
    copyBtn.classList.remove("copied");
  },1200);
};
</script>
</body>
</html>
